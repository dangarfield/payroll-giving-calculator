<!-- DG - START -->

<h2>Payroll Giving Calculator</h2>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla venenatis lorem eu sem condimentum finibus. Suspendisse egestas
    dignissim ante, at scelerisque felis. Cras urna diam, sodales a lacinia et, placerat a magna. Ut quis finibus nunc, ut
    dapibus leo. Etiam et ipsum id magna auctor bibendum.</p>


<div class="one_third">
    <label for="salary" class="salary-label">Enter your salary:</label>
</div>
<div class="two_third last">
    <div class="input-wrapper">
        <input type="text" name="salary" id="salary" value="" size="40" class="wpcf7-form-control wpcf7-text" placeholder="Your salary">
        <label for="salary" class="fa fa-gbp input-icon"></label>
    </div>
    <style type="text/css">
        .salary-label {
            padding-top: 13px;
            float: right;
        }

        .input-icon {
            position: absolute;
            left: 12px;
            top: calc(50% - 15px);
        }

        input {
            padding-left: 27px !important;
        }

        .input-wrapper {
            position: relative;
        }
    </style>
</div>

<div class="calc" style="display:none;">

    <p>Basic rate tax:
        <span class="tax-basic"></span>
    </p>
    <p>Higher rate tax:
        <span class="tax-higher"></span>
    </p>
    <p>Additional rate tax:
        <span class="tax-additional"></span>
    </p>
    <p>Total tax:
        <span class="tax-total"></span>
    </p>
    <p>National Insurance:
        <span class="ni"></span>
    </p>
    <p>Take Home Net:
        <span class="take-home-net"></span>
    </p>
    <p>Tithe:
        <span class="tithe"></span>
    </p>
    <p>Gift Aid:
        <span class="gift-aid"></span>
    </p>
    <p>Total Tithe Recieved:
        <span class="tithe-total"></span>
    </p>
    <p>Take Home Post Tithe:
        <span class="take-home-post"></span>
    </p>
    <p>Payroll Giving Tithe:
        <span class="tithe-payroll"></span>
    </p>
    <p>Payroll Giving Benefit:
        <span class="payroll-benefit"></span>
    </p>
</div>
<div class="spb_wrapper clearfix">
    <div class="one_third">
        <p>&nbsp;</p>
        <div class="sf-count-asset">
            <div class="count-number display-take-home" data-from="0" data-to="0" data-speed="500" data-refresh-interval="25" data-prefix="£"
                data-suffix="" data-with-commas="true">0</div>
            <div class="count-divider">
                <span style="width: 50px;"></span>
            </div>
            <h6 class="count-subject" style="opacity: 1; bottom: 0px;">Net take home pay after tithe (monthly)</h6>
        </div>
    </div>
    <div class="one_third">
        <p>&nbsp;</p>
        <div class="sf-count-asset">
            <div class="count-number display-payroll-tithe" data-from="0" data-to="0" data-speed="750" data-refresh-interval="25" data-prefix="£"
                data-suffix="" data-with-commas="true">0</div>
            <div class="count-divider">
                <span style="width: 50px;"></span>
            </div>
            <h6 class="count-subject" style="opacity: 1; bottom: 0px;">Total received by church through payroll giving</h6>
        </div>
    </div>
    <div class="one_third last">
        <p>&nbsp;</p>
        <div class="sf-count-asset">
            <div class="count-number display-payroll-benefit" data-from="0" data-to="0" data-speed="1000" data-refresh-interval="25"
                data-prefix="£" data-suffix="" data-with-commas="true">0</div>
            <div class="count-divider">
                <span style="width: 50px;"></span>
            </div>
            <h6 class="count-subject" style="opacity: 1; bottom: 0px;">Total benefit over gift aid</h6>
        </div>
    </div>
    <div class="clearboth"></div>
</div>

<script>
    const TAX_BASIC = 11850
    const TAX_BASIC_RATE = 0.2
    const TAX_HIGHER = 46350
    const TAX_HIGHER_RATE = 0.4
    const TAX_ADDITIONAL = 150000
    const TAX_ADDITIONAL_RATE = 0.45
    const TAX_ALLOWANCE_CUTOFF = 100000
    const TAX_ALLOWANCE_DROPOFF = 2

    const NI_BASIC = 8424
    const NI_BASIC_RATE = 0.12
    const NI_HIGHER = 46350
    const NI_HIGHER_RATE = 0.02

    const TITHE = 0.1
    const GIFTAID = 0.25

    function initCalc($, salary) {
        if (!salary) {
            return null
        }
        console.log('salary', salary)

        var taxBasic = salary > TAX_BASIC ? Math.floor((Math.min(salary,
                TAX_HIGHER) - TAX_BASIC) *
            TAX_BASIC_RATE) : 0
        $('.tax-basic').html(taxBasic)
        console.log('taxBasic', taxBasic)

        var paExcess = salary > TAX_ALLOWANCE_CUTOFF ? (salary -
            TAX_ALLOWANCE_CUTOFF) : 0
        var paOffset = paExcess / 2 > TAX_BASIC ? TAX_BASIC : (paExcess /
            TAX_ALLOWANCE_DROPOFF)

        var taxHigher = salary > TAX_HIGHER ? Math.floor(((Math.min(
                salary,
                TAX_ADDITIONAL) - TAX_HIGHER + paOffset)) *
            TAX_HIGHER_RATE) : 0
        $('.tax-higher').html(taxHigher)
        console.log('taxHigher', taxHigher, salary, Math.min(salary,
            TAX_ADDITIONAL), Math.min(salary,
            TAX_ADDITIONAL) - TAX_HIGHER, paExcess, paOffset)

        var taxAdditional = salary > TAX_ADDITIONAL ? Math.floor((
                salary -
                TAX_ADDITIONAL) *
            TAX_ADDITIONAL_RATE) : 0
        $('.tax-additional').html(taxAdditional)
        console.log('taxAdditional', taxAdditional)

        var taxTotal = taxBasic + taxHigher + taxAdditional
        $('.tax-total').html(taxTotal)
        console.log('taxTotal', taxTotal)

        var ni = salary > NI_HIGHER ? Math.floor((((NI_HIGHER -
                NI_BASIC) *
            NI_BASIC_RATE) + ((salary - NI_HIGHER) *
            NI_HIGHER_RATE))) : (salary > NI_BASIC ? Math.floor(((
                salary - NI_BASIC) *
            NI_BASIC_RATE)) : 0)
        $('.ni').html(ni)
        console.log('ni', ni)

        var takeHomeNet = salary - taxTotal - ni
        $('.take-home-net').html(takeHomeNet)
        console.log('take-home-net', takeHomeNet)

        var tithe = Math.floor(takeHomeNet * TITHE)
        $('.tithe').html(tithe)
        console.log('tithe', tithe)

        var giftAid = Math.floor(tithe * GIFTAID)
        $('.gift-aid').html(giftAid)
        console.log('gift-aid', giftAid)

        var titheTotal = tithe + giftAid
        $('.tithe-total').html(titheTotal)
        console.log('tithe-total', titheTotal)

        var takeHomePost = Math.floor((takeHomeNet - tithe) / 12)
        $('.take-home-post').html(takeHomePost)
        console.log('take-home-post', takeHomePost)

        var tithePayroll =
            salary > TAX_ADDITIONAL ?
            Math.floor(tithe / (1 - TAX_ADDITIONAL_RATE)) :
            (
                salary > TAX_HIGHER ?
                Math.floor(tithe / (1 - TAX_HIGHER_RATE)) :
                Math.floor(tithe / (1 - TAX_BASIC_RATE))
            )
        $('.tithe-payroll').html(tithePayroll)
        console.log('tithe-payroll', tithePayroll)

        var payrollBenefit = tithePayroll - titheTotal
        $('.payroll-benefit').html(payrollBenefit)
        console.log('payroll-benefit', payrollBenefit)

        $('.display-take-home').attr('data-to', takeHomePost)
        $('.display-take-home').countTo({
            to: takeHomePost,
            onComplete: function (value) {
                console.log('display-take-home complete',
                    takeHomePost, value)
            }
        })
        $('.display-payroll-tithe').attr('data-to', tithePayroll)
        $('.display-payroll-tithe').countTo({
            to: tithePayroll
        })
        $('.display-payroll-benefit').attr('data-to', payrollBenefit)
        $('.display-payroll-benefit').countTo({
            to: payrollBenefit
        })
        console.log('calculated')
    }
    jQuery(document).ready(function ($) {
        var previousSalary = 0
        $("#salary").keyup(function (event) {
            var salary = $(this).val()
            salary = Number(salary.replace(/[^0-9.]/g,
                ''))
            if (previousSalary !== salary) {
                previousSalary = salary
                $(this).val(salary)
                initCalc($, salary)
            }
        })
        $("#salary").val(60000)
        initCalc($, $("#salary").val())
    })
</script>
<!-- DG - END -->